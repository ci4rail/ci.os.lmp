header:
  version: 9
# The machine as it is written into the `local.conf` of bitbake.
machine: verdin-imx8mm
# The distro name as it is written into the `local.conf` of bitbake.
distro: tdx-xwayland
# The target that is built by bitbake
target: tdx-reference-minimal-image

repos:
  # from txd: https://git.toradex.com/cgit/toradex-manifest.git/tree/base/pinned.xml?h=dunfell-5.x.y
  #
  src/bitbake:
    url: "https://github.com/openembedded/bitbake.git"
    refspec: 838a89141fd6a75da9f982ad2b035e823b692d2a
    layers:
      # bitbake is no layer. Exclude it from bblayers.conf
      bitbake: "no"
  
  src/openembedded-core:
    url: "https://github.com/openembedded/openembedded-core.git"
    refspec: 0d4d0df6084cce3c3d9051db88f3199a030d3352
    layers:
      meta:

  src/meta-openembedded:
    url: "https://github.com/openembedded/meta-openembedded.git"
    refspec: 654ad8bea49f142d20b2b96c0dd44810a6be233a
    layers:
      meta-oe:
      meta-networking:
      meta-filesystems:
      meta-python:
      meta-xfce:
      meta-gnome:
      meta-multimedia:
      meta-initramfs:

  src/meta-yocto:
    url: "https://git.yoctoproject.org/git/meta-yocto.git"
    refspec: 432b365f48f58ec0d9692a93607b65edd098ca1a
    layers:
      meta-poky:

  # from tdx: https://git.toradex.com/cgit/toradex-manifest.git/tree/bsp/pinned-nxp.xml?h=dunfell-5.x.y
  src/meta-freescale-3rdparty.git:
    url: "https://github.com/Freescale/meta-freescale-3rdparty.git"
    refspec: 83644f2ea000c1ab92fc0da1c45e2d7fb7a6060c

  src/meta-freescale-distro:
    url: "https://github.com/Freescale/meta-freescale-distro.git"
    refspec: a1821b36af7bba4f6628e4244df7fc9a038d0f34
  
  src/meta-freescale:
    url: "https://github.com/Freescale/meta-freescale.git"
    refspec: bb582837c8c1ee08255b721f0bf946d6074c4773

  # from tdx: https://git.toradex.com/cgit/toradex-manifest.git/tree/bsp/pinned-tdx.xml?h=dunfell-5.x.y
  src/meta-toradex-bsp-common:
    url: "https://git.toradex.com/meta-toradex-bsp-common.git"
    refspec: 51927b354280c398b11b7b6bd64c1617825f17d1

  src/meta-toradex-nxp:
    url: "https://git.toradex.com/meta-toradex-nxp.git"
    refspec: fddb6cc10a1df717cc77b6958ce5e233cef9a80a

  src/meta-toradex-tegra:
    url: "https://git.toradex.com/meta-toradex-tegra.git"
    refspec: 962b01390fdc261b5f86921231792daa8f6af043

  # from tdx: https://git.toradex.com/cgit/toradex-manifest.git/tree/tdxref/default.xml?h=dunfell-5.x.y
  src/meta-qt5:
    url: "https://github.com/meta-qt5/meta-qt5.git"
    refspec: 0e7015f7a86dda995a39662edbb5c26da647c496

  src/meta-toradex-demos:
    url: "https://git.toradex.com/meta-toradex-demos.git"
    refspec: 93c179932a1a282bb56823ee202e387ced41f388

  src/meta-toradex-distro:
    url: "https://git.toradex.com/meta-toradex-distro.git"
    refspec: 1e0d10b2851ac455618ab7e4c7db86c9ad1227a0

  # mender, from: https://raw.githubusercontent.com/mendersoftware/meta-mender-community/dunfell/scripts/mender-no-setup-layers.xml
  src/meta-mender:
    url: "https://github.com/mendersoftware/meta-mender"
    refspec: 850a275ad65fc730b8b74c9ee9397091395ddbd6
    layers:
      meta-mender-core:
      meta-mender-demo:
      meta-mender-commercial:

  src/meta-mender-community:
    url: "https://github.com/mendersoftware/meta-mender-community"
    refspec: 2120d69c3d63405da5dcba2cefc678944b85a582
    layers:
      meta-mender-toradex-nxp:

  # Azure IotEdge
  src/meta-iotedge:
    url: https://github.com/Azure/meta-iotedge.git
    refspec: dunfell

  # Azure IotEdge dependencies
  src/meta-rust:
    url: git://github.com/meta-rust/meta-rust.git
    refspec: e4d25b98083bcecb94df6ee189a165d63ede7f3d

  src/meta-virtualization:
    url: git://git.yoctoproject.org/meta-virtualization
    refspec: dunfell

  # ci4rail
  src/meta-ci.os:
    url: https://github.com/ci4rail/meta-ci.os.git
    refspec: dunfell

bblayers_conf_header:
  src/meta-custom: |
    BBPATH = "${TOPDIR}"
    BBFILES ?= ""

env:
  MENDER_ARTIFACT_NAME: "DEFAULT_EMPTY_ARTIFACT_NAME"
  MENDER_SERVER_URL: "https://hosted.mender.io"
  MENDER_TENANT_TOKEN: "DEFAULT_EMPTY_TENANT_TOKEN"
  IMAGE_GIT_VERSION: ""
  IMAGE_NAME_SUFFIX: ""

local_conf_header:
  src/meta-custom: |
    DL_DIR ?= "/downloads"
    SSTATE_DIR ?= "/sstate-cache"
    DEPLOY_DIR = "/install"
    PACKAGE_CLASSES ?= "package_ipk"
    EXTRA_IMAGE_FEATURES ?= "debug-tweaks package-management"
    USER_CLASSES ?= "buildstats image-mklibs image-prelink"
    PATCHRESOLVE = "noop"
    BB_DISKMON_DIRS ??= "\
        STOPTASKS,${TMPDIR},1G,100K \
        STOPTASKS,${DL_DIR},1G,100K \
        STOPTASKS,${SSTATE_DIR},1G,100K \
        STOPTASKS,/tmp,100M,100K \
        ABORT,${TMPDIR},100M,1K \
        ABORT,${DL_DIR},100M,1K \
        ABORT,${SSTATE_DIR},100M,1K \
        ABORT,/tmp,10M,1K"
    PACKAGECONFIG_append_pn-qemu-system-native = " sdl"
    PACKAGECONFIG_append_pn-nativesdk-qemu = " sdl"
    CONF_VERSION = "1"
    INHERIT += "rm_work"
    INHERIT += "toradex-mirrors"
    DISTRO = "tdx-xwayland"
    include conf/machine/include/${MACHINE}.inc
    INHERIT += "mender-full"
    DISTRO_FEATURES_append = " systemd virtualization"
    VIRTUAL-RUNTIME_init_manager = "systemd"
    DISTRO_FEATURES_BACKFILL_CONSIDERED = "sysvinit"
    VIRTUAL-RUNTIME_initscripts = ""
    MENDER_FEATURES_ENABLE_append = " mender-uboot mender-image-sd"
    MENDER_FEATURES_DISABLE_append = " mender-grub mender-image-uefi"
    IMAGE_CLASSES += "image_type_mender_tezi"
    IMAGE_FSTYPES_append = " mender_tezi"
    IMAGE_FSTYPES_remove = " teziimg"
    KERNEL_IMAGETYPE_aarch64_mender-grub = "Image"
    IMAGE_BOOT_FILES = ""
    IMAGE_BOOT_FILES_remove_mender-grub = "boot.scr-verdin-imx8mm;boot.scr"
    OFFSET_SPL_PAYLOAD_verdin-imx8mm = ""
    ACCEPT_FSL_EULA = "1"
    IMAGE_FEATURES_append = " read-only-rootfs"
    IMAGE_INSTALL_append = " mender-binary-delta nano iotedge-daemon iotedge-cli docker ca-certificates connman connman-client"
    LICENSE_FLAGS_WHITELIST = "commercial_mender-binary-delta"
    FILESEXTRAPATHS_prepend_pn-mender-binary-delta := "/mender/mender-binary-delta/:"
    MENDER_UPDATE_POLL_INTERVAL_SECONDS ?= "20"
    MENDER_INVENTORY_POLL_INTERVAL_SECONDS ?= "20"
    MENDER_STORAGE_TOTAL_SIZE_MB = "4096"
